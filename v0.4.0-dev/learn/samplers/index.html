
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../data-collection/" rel="prev"/>
<link href="../collector/" rel="next"/>
<link href="../../assets/neblic-favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.0.11" name="generator"/>
<title>Samplers - Documentation</title>
<link href="../../assets/stylesheets/main.0d440cfe.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.2505c338.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../assets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#samplers">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<div data-md-component="outdated" hidden="">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Documentation" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Documentation">
<img alt="logo" src="../../assets/neblic-logo-white.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Samplers
            
          </span>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Documentation">
<img alt="logo" src="../../assets/neblic-logo-white.png"/>
</a>
    Documentation
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        What is Neblic
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Use cases
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Use cases
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-cases/event-driven/">
        Event-driven applications
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-cases/real-time-data-streaming/">
        Real-time data streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../use-cases/api-monitoring/">
        API monitoring
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Quickstart
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Quickstart
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../quickstart/how-does-neblic-work/">
        How does Neblic work
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Getting started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/concepts/">
        Concepts
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/usage/">
        Usage
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Learn
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Learn
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../data-collection/">
        Data collection
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Samplers
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Samplers
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#best-practices">
    Best practices
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
    Configuration
  </a>
<nav aria-label="Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#streams">
    Streams
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#digests-and-metrics">
    Digests and Metrics
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#events">
    Events
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#available-samplers">
    Available Samplers
  </a>
<nav aria-label="Available Samplers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#go">
    Go
  </a>
<nav aria-label="Go" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-encodings">
    Supported encodings
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#grpc-interceptors">
    gRPC interceptors
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#instrumentation-overhead-advanced">
    Instrumentation overhead (advanced)
  </a>
<nav aria-label="Instrumentation overhead (advanced)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#json-samples">
    JSON samples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#protobuf-samples">
    Protobuf Samples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#go-native-samples">
    Go native samples
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kafka">
    Kafka
  </a>
<nav aria-label="Kafka" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-encodings_1">
    Supported encodings
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#instrumentation-overhead-advanced_1">
    Instrumentation overhead (advanced)
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced">
    Advanced
  </a>
<nav aria-label="Advanced" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#using-opentelemetry-sdk">
    Using OpenTelemetry SDK
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../collector/">
        Collector
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../storage/">
        Storage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../protocol/">
        Protocol
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          How-to guides
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          How-to guides
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../how-to/data-from-go-svc/">
        Get data from Go services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../how-to/data-from-java-svc/">
        Get data from Java services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../how-to/data-from-other-svc/">
        Get data from other services
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../how-to/data-from-kafka/">
        Get data from Apache Kafka
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../how-to/configure-samplers-using-neblictl/">
        Configure Samplers using neblictl
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../how-to/store-and-visualize-data-with-loki/">
        Store and visualize data with Loki
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../how-to/build-your-own-collector/">
        Build your own collector
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/rules/">
        Rules
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/collector/">
        Collector
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/neblictl/">
        Neblictl
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/kafka-sampler/">
        Kafka Sampler
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="https://pkg.go.dev/github.com/neblic/platform/sampler">
        Go Sampler
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../reference/benchmarks/">
        Benchmarks
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#best-practices">
    Best practices
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration">
    Configuration
  </a>
<nav aria-label="Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#streams">
    Streams
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#digests-and-metrics">
    Digests and Metrics
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#events">
    Events
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#available-samplers">
    Available Samplers
  </a>
<nav aria-label="Available Samplers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#go">
    Go
  </a>
<nav aria-label="Go" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-encodings">
    Supported encodings
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#grpc-interceptors">
    gRPC interceptors
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#instrumentation-overhead-advanced">
    Instrumentation overhead (advanced)
  </a>
<nav aria-label="Instrumentation overhead (advanced)" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#json-samples">
    JSON samples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#protobuf-samples">
    Protobuf Samples
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#go-native-samples">
    Go native samples
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kafka">
    Kafka
  </a>
<nav aria-label="Kafka" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#supported-encodings_1">
    Supported encodings
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#instrumentation-overhead-advanced_1">
    Instrumentation overhead (advanced)
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced">
    Advanced
  </a>
<nav aria-label="Advanced" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#using-opentelemetry-sdk">
    Using OpenTelemetry SDK
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="samplers">Samplers<a class="headerlink" href="#samplers" title="Permanent link">¶</a></h1>
<p><em>Samplers</em> are available as libraries to be imported into your services or are created by standalone components that retrieve <em>Data Samples</em> from a system (such as a data broker or a database) by themselves such as the <a href="../../how-to/data-from-kafka/"><code>kafka-sampler</code></a>.</p>
<p>They are designed to not interfere with the normal operation of your systems and to not impact your application performace. Go to the <a href="/learn/data-collection/#sampler">Data Collection</a> page to get a deeper understanding of how a <em>Sampler</em> works.</p>
<p><em>Samplers</em> need to be able to decode the data that they intercept so that it can be evaluated by their configured <em>Streams</em>, which decide whether or not that <em>Data Sample</em> needs to be processed. Therefore, you need to choose a <em>Sampler</em> that is compatible with the message encoding (e.g. Protocol Buffers, JSON...) that your service works with.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All <em>Samplers</em> are able to process <em>JSON</em> messages. Since it is a self-describing language, it is enough with the message itself (no external schema required) to be able to decode its contents. And since, at least when using <em>Samplers</em> within your services, it is usually possible to convert any object to <em>JSON</em>, this option works as a fallback in case the encoding your service uses is not supported. Of course, there is a performance penalty to consider when converting messages to <em>JSON</em>. </p>
</div>
<h2 id="best-practices">Best practices<a class="headerlink" href="#best-practices" title="Permanent link">¶</a></h2>
<p>Because their performance impact is negligible when no <em>Streams</em> are configured, it is recommended to add them wherever data is transformed or exchanged. This will allow you to track how your data evolves throughout your system. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unlike logs, where it is usually recommended to not add logging in the critical path to avoid too much noise and increased costs, <em>Samplers</em> can be dynamically configured so you can add them anywhere without worrying about impacting your application or costs. </p>
</div>
<p><em>Samplers</em> have sensible defaults to protect your services and never export large amounts of data without your permission. By default, they have a rate limit that puts a ceiling on how many <em>Data Samples</em> they export per second. All of these default options can be adjusted at runtime using a Neblic client, like <em>neblictl</em>, if you need it (e.g. temporarily increase the rate limit while troubleshooting an issue).</p>
<p>For example, it is common to add <em>Samplers</em> in all service or module boundaries:</p>
<ul>
<li>Requests and responses sent between services (e.g. HTTP API requests, gRPC calls...)</li>
<li>Data passed to/from modules/libraries used within the same service</li>
<li>Requests/responses or messages to external systems (e.g. DBs, Apache Kafka...)</li>
</ul>
<p>Other interesting places could be:</p>
<ul>
<li>Before/after relevant data transformation</li>
<li>When a service starts, to register its configuration</li>
</ul>
<p>To make it easier to get <em>Data Samples</em> from multiple places, Neblic provides helpers, wrappers, and components that can automatically add <em>Samplers</em> in multiple places in your system e.g. in all gRPC requests/responses or in multiple Kafka topics. Check out the next sections to see what <em>Samplers</em> Neblic provides.</p>
<h2 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">¶</a></h2>
<p>The pair <em>Sampler</em> name and resource id is what identifies a particular set of <em>Samplers</em>. For example, if you have multiple replicas of the same service, each replica will register a <em>Sampler</em> with the same name and resource id. All of these <em>Samplers</em> are treated as a group and you can configure them all together.</p>
<p>The <a href="/learn/data-collection/">Data Collection</a> page shows all the operations performed by a <em>Sampler</em> and the <em>Collector</em> and provide the foundation to understand how to configure the <em>Sampler</em> behaviour. See this <a href="../../how-to/configure-samplers-using-neblictl/">how-to</a> page to learn how to configure <em>Samplers</em> using <em>neblictl</em>.</p>
<h3 id="streams">Streams<a class="headerlink" href="#streams" title="Permanent link">¶</a></h3>
<p><em>Streams</em> are the initial configuration that <em>Samplers</em> need to be able to start generating <em>Data Telemetry</em>. To create a <em>Stream</em> you need to provide a target <em>Sampler</em> and a <a href="/reference/rules">rule</a> which will select which <em>Data Samples</em> are part of the <em>Stream</em>.</p>
<p><em>Data Samples</em> can have a key associated with them. By setting up a <em>Stream</em> as keyed, you can gather <em>Data Telemetry</em> separately for each key value. This feature is handy, for example, for collecting independent <em>Data Telemetry</em> for different customers (by using the customer ID as the key) or for various <em>Event</em> types (using the event type ID as the key). Currently, only <em>Events</em> are compatible with keyed <em>Streams</em>. For details on which functions are compatible with keyed <em>Streams</em>, please check the <a href="/reference/rules">reference table</a>.</p>
<h3 id="digests-and-metrics">Digests and Metrics<a class="headerlink" href="#digests-and-metrics" title="Permanent link">¶</a></h3>
<p><em>Digests</em> are generated at the <em>Stream</em> level. First, you need to create a <em>Stream</em> and then you will be able to generate the required <em>Digests</em>. <em>Metrics</em> are generated from <em>Digests</em> so you first need to create a <em>Digest</em> and then the <em>Collector</em> will automatically generate and export <em>Metrics</em> based on its contents.</p>
<h3 id="events">Events<a class="headerlink" href="#events" title="Permanent link">¶</a></h3>
<p><em>Events</em> are generated in the <em>Collector</em> and also work at the <em>Stream</em> level. To generate <em>Events</em> you will need to create a <em>Stream</em> and configure it to export <em>Raw Data</em> to the <em>Collector</em>. </p>
<p>Then, you can create <em>Events</em> by specifying the target <em>Stream</em> and a <a href="/reference/rules">rule</a> that will trigger the generation of the <em>Event</em>.</p>
<h2 id="available-samplers">Available Samplers<a class="headerlink" href="#available-samplers" title="Permanent link">¶</a></h2>
<h3 id="go">Go<a class="headerlink" href="#go" title="Permanent link">¶</a></h3>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Check <a href="../../how-to/data-from-go-svc/">this guide</a> for an example of how to use it and the <a href="https://pkg.go.dev/github.com/neblic/platform/sampler">Godoc</a> page for reference.</p>
</div>
<!-- BEGIN INCLUDE ../../../sampler/README.md '&lt;!--learn-start--&gt;' '&lt;!--learn-end--&gt;' -->
<!-- ### Go  -->
<p>The Go <em>Sampler</em> module allows you to get <em>Data Samples</em> from your Go services.</p>
<h4 id="supported-encodings">Supported encodings<a class="headerlink" href="#supported-encodings" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Encoding</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>JSON</td>
<td>A string containing a JSON object.</td>
</tr>
<tr>
<td>Protobuf</td>
<td>It can efficiently process <code>proto.Message</code> objects if the Protobuf message definition is provided.</td>
</tr>
<tr>
<td>Go native object</td>
<td>Only capable of accessing exported fields. This is a limitation of the Go language.</td>
</tr>
</tbody>
</table>
<h4 id="grpc-interceptors">gRPC interceptors<a class="headerlink" href="#grpc-interceptors" title="Permanent link">¶</a></h4>
<p>The Go library also provides a package to easily add <em>Samplers</em> as gRPC interceptors. This will automatically add <em>Samplers</em> in each gRPC method that will intercept all requests and responses.</p>
<h4 id="instrumentation-overhead-advanced">Instrumentation overhead (advanced)<a class="headerlink" href="#instrumentation-overhead-advanced" title="Permanent link">¶</a></h4>
<p>The Go <em>Sampler</em> module is fully functional, but it has not yet been thoroughly optimized. Therefore, there are some use cases where it may exhibit more overhead than desired, which you need to be aware of if your application processes a large volume of data or it is resource-constrained.</p>
<p>Take into account that the instrumentation overhead in most cases won't affect your application, in any case, since the <em>Sampler</em> behavior can be dynamically configured at runtime, it is recommended to set an input limiter when it is first deployed and adjust it while monitoring it. You can also adjust it as needed during a troubleshooting session and have it mostly inactive when unused.</p>
<p>Check the <a href="https://docs.neblic.com/latest/reference/benchmarks/#go-sampler">benchmarks page</a> to see the latest results. The sections below offer a performance analysis for each supported <em>Data Sample</em> encoding. The majority of the overhead is due to the serialization and/or deserialization of the <em>Data Sample</em>. Therefore, the overhead is mostly influenced by the number of fields in the <em>Data Sample</em> and, to a lesser degree, its overall size.</p>
<h5 id="json-samples">JSON samples<a class="headerlink" href="#json-samples" title="Permanent link">¶</a></h5>
<p>The JSON sample is deserialized with <a href="https://github.com/goccy/go-json">go-json</a> to determine to which <em>Streams</em> it belongs and to generate <em>Digests</em>. This action dominates the <em>Sampler</em> computational overhead. The plan is to not deserialize it into a <code>map[string]interface{}</code> but instead to simply iterate over it and convert the values as needed on-the-fly reusing memory buffers when possible. See <a href="https://github.com/orgs/neblic/projects/3/views/1?pane=issue&amp;itemId=55387008">this</a> project item for details.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>If your application is very resource constrained, you can create a <em>Stream</em> that doesn't require to deserialize the JSON sample (e.g. you can use the rule <code>true</code>) and forward the raw <em>Data Sample</em> to the <em>Collector</em> and generate the <em>Digests</em> there. This will create network overhead since it will need to forward the <em>Data Samples</em> to the <em>Collector</em> but will not impact your application CPU usage.</p>
</div>
<h5 id="protobuf-samples">Protobuf Samples<a class="headerlink" href="#protobuf-samples" title="Permanent link">¶</a></h5>
<p><em>Stream</em> matching is very fast, since it doesn't require to deserialize the <em>Data Sample</em>. But generating <em>Digests</em> requires the <em>Data Sample</em> to be deserialized into a <code>map[string]interface{}</code> which will dominate the <em>Sampler</em> processing overhead. The plan is to not deserialize it and iterate over its fields using the proto <code>reflect</code> package. See <a href="https://github.com/orgs/neblic/projects/3/views/1?pane=issue&amp;itemId=55388757">this</a> project item for details.</p>
<p>Forwarding raw <em>Data Samples</em> sampled encoded as protobuf is also not as performant as we would like (see <a href="https://github.com/golang/protobuf/issues/1285">this issue</a>). The plan is to not serialize it to JSON when forwarding it to the <em>Collector</em> but use a more efficient serialization format. It is also planned to not serialize the whole sample unless strictly necessary. See <a href="https://github.com/orgs/neblic/projects/3/views/1?pane=issue&amp;itemId=55389519">this</a> and <a href="https://github.com/orgs/neblic/projects/3/views/1?pane=issue&amp;itemId=53479138">this</a> project items for details.</p>
<h5 id="go-native-samples">Go native samples<a class="headerlink" href="#go-native-samples" title="Permanent link">¶</a></h5>
<p><em>Stream</em> matching and <em>Digest</em> generation requires the sample to be deserialized into a <code>map[string]interface{}</code> which has some overhead but is quite acceptable since it doesn't require to perform as many memory allocations as when deserializing a JSON or a Protobuf encoded sample. It is unclear if iterating over the sample and not creating a <code>map</code> using reflection will reduce the deserialization overhead.</p>
<p>Exporting raw <em>Data Samples</em> requires them to be serialized to JSON. As in the previous case, using a different serialization format and only exporting the necessary parts of the data sample will help reduce its impact. See <a href="https://github.com/orgs/neblic/projects/3/views/1?pane=issue&amp;itemId=55389519">this</a> and <a href="https://github.com/orgs/neblic/projects/3/views/1?pane=issue&amp;itemId=53479138">this</a> project items for details.</p>
<!-- END INCLUDE -->
<h3 id="kafka">Kafka<a class="headerlink" href="#kafka" title="Permanent link">¶</a></h3>
<!-- BEGIN INCLUDE ../../../cmd/kafka-sampler/README.md '&lt;!--learn-start--&gt;' '&lt;!--learn-end--&gt;' -->
<!-- ### Kafka -->
<p>Neblic provides a standalone service called <code>kafka-sampler</code> capable of automatically monitoring your <em>Apache Kafka</em> topics and creating <em>Samplers</em> that will allow you to inspect all data that flows through them.</p>
<h4 id="supported-encodings_1">Supported encodings<a class="headerlink" href="#supported-encodings_1" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>Encoding</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>JSON</td>
<td>A string containing a JSON object.</td>
</tr>
</tbody>
</table>
<h4 id="instrumentation-overhead-advanced_1">Instrumentation overhead (advanced)<a class="headerlink" href="#instrumentation-overhead-advanced_1" title="Permanent link">¶</a></h4>
<p>The <code>kafka-sampler</code> service is based on the <code>Go</code> <em>Sampler</em>. Check its <a href="https://docs.neblic.com/latest/learn/samplers/#instrumentation-overhead-advanced">overhead analysis</a> for details.</p>
<!-- END INCLUDE -->
<p>Check <a href="../../how-to/data-from-kafka/">this guide</a> to learn how to use it.</p>
<h2 id="advanced">Advanced<a class="headerlink" href="#advanced" title="Permanent link">¶</a></h2>
<h3 id="using-opentelemetry-sdk">Using OpenTelemetry SDK<a class="headerlink" href="#using-opentelemetry-sdk" title="Permanent link">¶</a></h3>
<p>The Neblic collector is built on top of OpenTelemetry stack, and as a result, the neblic collector is capable of understanding and processing samples encoded
as OpenTelemetry logs if they are correctly formatted. Any <a href="https://opentelemetry.io/docs/languages/#status-and-releases">OpenTelemetry SDK implementation supporting logs</a> can be used to generate samples that neblic
will process.</p>
<p>Concept match beetween OpenTelemetry and Neblic:</p>
<table>
<thead>
<tr>
<th>OpenTelemetry</th>
<th>Neblic</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://opentelemetry.io/docs/specs/otel/resource/sdk/">Resource</a></td>
<td>Resource</td>
</tr>
<tr>
<td><a href="https://opentelemetry.io/docs/specs/otel/glossary/#instrumentation-scope">InstrumentationScope</a></td>
<td><a href="../../getting-started/concepts/#sampler">Sampler</a></td>
</tr>
<tr>
<td>Attribute <code>com.neblic.sample.stream.names</code></td>
<td><a href="../../getting-started/concepts/#stream">Stream</a></td>
</tr>
<tr>
<td>Attribute <code>com.neblic.sample.key</code></td>
<td><a href="../../getting-started/concepts/#keyed-stream">Key</a></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>OpenTelemetry recommends using appenders to propagate logs, for that use case it does not work, and the Logs API is used instead.</p>
</div>
<p>Steps to follow:</p>
<ul>
<li>Create a <a href="https://opentelemetry.io/docs/specs/otel/logs/bridge-api/#loggerprovider">LoggerProvider</a> with the desired <em>Resource</em> name.</li>
<li>Create a <a href="https://opentelemetry.io/docs/specs/otel/logs/bridge-api/#logger">Logger</a> with the desired sampler name as the <em>InstrumentationScope</em> name.</li>
<li>Emit a log with:<ul>
<li>Attribute <code>com.neblic.sample.stream.names* with value *all</code></li>
<li>Attribute <code>com.neblic.sample.key</code> with the desired key value</li>
<li>Attribute <code>com.neblic.sample.type* with value *raw</code></li>
<li>Attribute <code>com.neblic.sample.encoding* with value *json</code></li>
<li>Body with the serialized version of the data</li>
</ul>
</li>
</ul>
<p>Once the collector receives the first sample, the sampler will appear to the controlplane as any other sampler (but with limited functionality) </p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Data collection" class="md-footer__link md-footer__link--prev" href="../data-collection/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Previous
                </span>
                Data collection
              </div>
</div>
</a>
<a aria-label="Next: Collector" class="md-footer__link md-footer__link--next" href="../collector/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                  Next
                </span>
                Collector
              </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2024 - Neblic
    </div>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/neblic" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://www.instagram.com/neblic/" rel="noopener" target="_blank" title="www.instagram.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"></path></svg>
</a>
<a class="md-social__link" href="https://www.linkedin.com/company/neblic-data" rel="noopener" target="_blank" title="www.linkedin.com">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
</a>
<a class="md-social__link" href="https://twitter.com/neblichq" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
<a class="md-social__link" href="https://www.youtube.com/@NeblicHQ" rel="noopener" target="_blank" title="www.youtube.com">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.annotate", "navigation.footer"], "search": "../../assets/javascripts/workers/search.db81ec45.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../../assets/javascripts/bundle.6df46069.min.js"></script>
<!-- Google tag (gtag.js) -->
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-JZM88PR6K2"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-JZM88PR6K2');
  </script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>